## BuyCredits

`BuyCredits` is a React component responsible for handling the **purchase of credits** using **Razorpay payment gateway**.  
It displays multiple credit plans, creates Razorpay orders through the backend, and verifies payments after successful checkout.



## initPay

`initPay` is an asynchronous function that initializes the Razorpay payment modal using the order object returned by the backend.

### Parameters

- **order**: `Object` – Contains Razorpay order details such as `id`, `amount`, `currency`, and `receipt`.

### Returns

`Promise<void>`  
- Opens Razorpay payment modal.  
- On successful payment, verifies the payment with the backend.  
- Updates user credits and navigates to the homepage.

### Flow

1. Build the **Razorpay `options` object** containing payment details and handler callback.  
2. Initialize Razorpay checkout with `new window.Razorpay(options)`.  
3. On successful payment, call backend `/verify-razor` API for signature verification.  
4. If verification is successful, call `loadCreditsData()`, redirect to `/`, and show a success toast.



## paymentRazorpay

`paymentRazorpay` is an asynchronous function that creates a **Razorpay order** on the backend for a selected credit plan.  
If the user is not logged in, it triggers the login modal.

### Parameters

- **planId**: `string` – The ID of the selected credit plan to purchase.

### Returns

`Promise<void>`  
- **200** – If order is created successfully and Razorpay modal is opened.  
- **401** – If the user is not logged in (login modal is shown).  
- **500** – For any server or network errors.

### Flow

1. Check if the user is logged in.  
   - If not, display the login popup using `setShowLogin(true)` and stop execution.  
2. Send a POST request to `/api/user/pay-razor` with `planId` to generate a Razorpay order.  
3. If the backend responds with success, call `initPay()` with the generated order object.



## Complete Flow

1. User visits the Buy Credits page and sees multiple plans.  
2. User clicks **Purchase / Get Started** on a plan.  
3. If not logged in → login popup appears.  
4. If logged in → a Razorpay order is generated by the backend.  
5. Razorpay modal opens for payment.  
6. After successful payment → frontend verifies it through `/verify-razor`.  
7. If verification is successful → credits are added, user is redirected to home, and a success toast is shown.

